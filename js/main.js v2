// Main JavaScript for the template
// - Mobile nav toggle
// - Smooth scroll handling for anchor links
// - IntersectionObserver to add 'visible' to elements with .fade-in
// - Simple contact form submit interception (POSTs to placeholder and shows status)

// ============ Mobile menu toggle ============
const mobileMenuButton = document.getElementById('mobile-menu-button');
const mobileMenu = document.getElementById('mobile-menu');
const hamburgerIcon = document.getElementById('hamburger');
const closeIcon = document.getElementById('close-icon');

if (mobileMenuButton) {
  mobileMenuButton.addEventListener('click', () => {
    const isOpen = mobileMenu.classList.toggle('hidden') === false;
    hamburgerIcon.classList.toggle('hidden', isOpen);
    closeIcon.classList.toggle('hidden', !isOpen);
  });
}

// ============ Smooth scroll for nav links (enhanced) ============
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    // let the browser handle external or empty hrefs
    const href = this.getAttribute('href');
    if (!href || href === '#') return;

    // Only handle same-page anchors
    if (href.startsWith('#')) {
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        // Close mobile menu when navigating
        if (!mobileMenu.classList.contains('hidden')) {
          mobileMenu.classList.add('hidden');
          hamburgerIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        }
      }
    }
  });
});

// ============ Scroll-triggered animations ============
const observerOptions = {
  root: null,
  rootMargin: '0px',
  threshold: 0.12
};

const onIntersection = (entries, observer) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
      observer.unobserve(entry.target);
    }
  });
};

// Add fade-in class to sections/cards to animate them in
document.addEventListener('DOMContentLoaded', () => {
  const toAnimate = document.querySelectorAll(
    '#features .feature-card, #testimonials .testimonial-card, #pricing .pricing-card, #contact form'
  );

  toAnimate.forEach(el => {
    el.classList.add('fade-in'); // initial state defined in css
  });

  const observer = new IntersectionObserver(onIntersection, observerOptions);
  toAnimate.forEach(el => observer.observe(el));
});

// ============ Simple contact form handling (placeholder) ============
const contactForm = document.getElementById('contact-form');
const formStatus = document.getElementById('form-status');

if (contactForm) {
  contactForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    formStatus.textContent = 'Sending...';

    // collect form data
    const formData = new FormData(contactForm);
    const payload = Object.fromEntries(formData.entries());

    try {
      // Example POST to placeholder URL. Replace with your API endpoint.
      const res = await fetch(contactForm.action, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });

      if (res.ok) {
        formStatus.textContent = 'Message sent! We will get back to you soon.';
        contactForm.reset();
      } else {
        formStatus.textContent = 'Oops — there was an issue sending your message.';
      }
    } catch (err) {
      console.error('Form submit error:', err);
      formStatus.textContent = 'Network error — please try again later.';
    }
  });
}

// ============ Footer dynamic year ============
const yearEl = document.getElementById('year');
if (yearEl) yearEl.textContent = new Date().getFullYear();
